<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PäätösTutka — Kokkola</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Mono:wght@300;400;500&family=Syne:wght@400;600;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
  :root {
    --bg: #0a0c0f;
    --bg2: #10141a;
    --bg3: #161c24;
    --border: #1e2830;
    --border2: #2a3540;
    --text: #e8edf2;
    --text2: #8a9ab0;
    --text3: #4a5a6a;
    --accent: #3b82f6;
    --accent2: #1d4ed8;
    --green: #22c55e;
    --red: #ef4444;
    --amber: #f59e0b;
    --cyan: #06b6d4;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Inter', sans-serif; /* Parempi luettavuus */
    min-height: 100vh;
    overflow-x: hidden;
    line-height: 1.5;
  }

  /* Skeleton Animation */
  @keyframes shimmer {
    0% { opacity: 0.5; }
    50% { opacity: 0.8; }
    100% { opacity: 0.5; }
  }
  .skeleton {
    animation: shimmer 1.5s infinite ease-in-out;
    background: var(--bg3);
    border-radius: 4px;
    height: 1em;
    width: 100%;
    margin-bottom: 8px;
  }

  /* NAV */
  nav {
    position: fixed; top: 0; left: 0; right: 0; z-index: 100;
    display: flex; align-items: center; justify-content: space-between;
    padding: 16px 32px;
    background: rgba(10,12,15,0.85);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border);
  }

  .nav-logo {
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: 1.1rem;
    letter-spacing: -0.02em;
    color: var(--text);
  }
  .nav-logo span { color: var(--accent); }

  .nav-links { display: flex; gap: 8px; }
  .nav-btn {
    padding: 8px 16px;
    border-radius: 6px;
    border: none;
    background: transparent;
    color: var(--text2);
    font-family: 'Inter', sans-serif;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
  }
  .nav-btn:hover, .nav-btn.active { background: var(--bg3); color: var(--text); }
  .nav-btn.cta { background: var(--accent); color: #fff; font-weight: 600; }
  .nav-btn.cta:hover { background: var(--accent2); }

  /* VIEWS */
  .view { display: none; padding-top: 80px; }
  .view.active { display: block; }

  /* DASHBOARD LAYOUT */
  .dashboard {
    padding: 32px;
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    gap: 24px;
  }

  .dash-header { margin-bottom: 8px; }
  .dash-title { font-family: 'DM Serif Display', serif; font-size: 2.2rem; }
  .dash-title span { color: var(--text2); font-size: 0.9rem; font-family: 'DM Mono'; font-weight: 300; }

  /* CARDS */
  .stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
  }

  .stat-card {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 24px;
    position: relative;
    overflow: hidden;
  }
  .stat-card::before {
    content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
    background: var(--accent-color, var(--accent));
  }

  .stat-label { font-size: 0.75rem; color: var(--text3); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 8px; font-family: 'DM Mono'; }
  .stat-value { font-family: 'Syne', sans-serif; font-size: 1.8rem; font-weight: 800; line-height: 1.2; }
  .stat-change { font-size: 0.75rem; margin-top: 8px; font-family: 'DM Mono'; }
  .stat-change.up { color: var(--green); }
  .stat-change.down { color: var(--red); }

  .card {
    background: var(--bg2);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }

  .card-header {
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: rgba(255,255,255,0.02);
  }

  .card-title { font-family: 'Syne', sans-serif; font-size: 1rem; font-weight: 700; }

  /* DECISION ITEMS */
  .decision-item {
    padding: 16px 24px;
    border-bottom: 1px solid var(--border);
    cursor: pointer;
    transition: background 0.2s;
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 16px;
    align-items: center;
  }
  .decision-item:hover { background: var(--bg3); }
  .decision-title { font-weight: 500; font-size: 0.95rem; color: var(--text); }
  .decision-meta { font-size: 0.75rem; color: var(--text3); font-family: 'DM Mono'; margin-top: 4px; }

  /* UTILS */
  .status-passed { background: rgba(34,197,94,0.1); color: var(--green); padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; font-family: 'DM Mono'; }

  @media (max-width: 768px) {
    nav { padding: 12px 16px; }
    .nav-links { display: none; } /* Mobiilissa yksinkertaisempi */
    .dashboard { padding: 16px; }
    .stat-value { font-size: 1.5rem; }
  }
</style>
</head>
<body>

<nav>
  <div class="nav-logo">Päätös<span>Tutka</span></div>
  <div class="nav-links">
    <button class="nav-btn active" onclick="showView('landing')">Etusivu</button>
    <button class="nav-btn" onclick="showView('dashboard')">Dashboard</button>
    <button class="nav-btn cta">Kirjaudu sisään</button>
  </div>
</nav>

<div class="view active" id="view-landing">
  <div style="height: 80vh; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 20px;">
    <h1 style="font-family: 'DM Serif Display'; font-size: 4rem; margin-bottom: 20px;">Parempia päätöksiä.<br><span style="color: var(--accent)">Data edellä.</span></h1>
    <p style="max-width: 600px; color: var(--text2); margin-bottom: 40px;">Seuraa Kokkolan päätöksentekoa, taloutta ja väestökehitystä yhdestä paikasta.</p>
    <button class="nav-btn cta" style="padding: 16px 32px; font-size: 1rem;" onclick="showView('dashboard')">Avaa Dashboard →</button>
  </div>
</div>

<div class="view" id="view-dashboard">
  <div class="dashboard">
    <div class="dash-header">
      <div class="dash-title">Kokkola <span>/ Tilannekuva</span></div>
    </div>

    <div class="stats-row">
      <div class="stat-card" style="--accent-color: var(--cyan)">
        <div class="stat-label">Väkiluku</div>
        <div id="stat-vaesto" class="stat-value"><div class="skeleton" style="width: 80%"></div></div>
        <div id="stat-vaesto-change" class="stat-change">Ladataan...</div>
      </div>
      <div class="stat-card" style="--accent-color: var(--red)">
        <div class="stat-label">Työttömyysaste</div>
        <div id="stat-tyottomyys" class="stat-value"><div class="skeleton" style="width: 60%"></div></div>
        <div id="stat-tyottomyys-change" class="stat-change">Ladataan...</div>
      </div>
      <div class="stat-card" style="--accent-color: var(--green)">
        <div class="stat-label">Alle 15v osuus</div>
        <div id="stat-nuoret" class="stat-value"><div class="skeleton" style="width: 50%"></div></div>
        <div id="stat-nuoret-change" class="stat-change">Ladataan...</div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-title">Viimeisimmät päätökset</div>
      </div>
      <div id="decisions-list">
        <div class="decision-item"><div class="skeleton"></div></div>
        <div class="decision-item"><div class="skeleton"></div></div>
        <div class="decision-item"><div class="skeleton"></div></div>
      </div>
    </div>
  </div>
</div>

<script>
  // TÄSSÄ ON SAMA LOGIIKKA KUIN AIEMMIN, MUTTA SIIVOTTUNA
  const PROXY_URL = 'https://kaupunki.onrender.com/decisions';
  const STAT_URL = 'https://pxdata.stat.fi/PxWeb/api/v1/fi/StatFin/vaerak/statfin_vaerak_pxt_11ra.px';

  function showView(name) {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.getElementById('view-' + name).classList.add('active');
    if(name === 'dashboard') {
      loadStats();
      loadDecisions();
    }
  }

  async function fetchStat(tiedot, vuosi) {
    const body = {
      query: [
        { code: 'Alue', selection: { filter: 'item', values: ['KU272'] } },
        { code: 'Tiedot', selection: { filter: 'item', values: [tiedot] } },
        { code: 'Vuosi', selection: { filter: 'item', values: [vuosi] } }
      ],
      response: { format: 'json' }
    };
    const res = await fetch(STAT_URL, { method: 'POST', body: JSON.stringify(body) });
    const data = await res.json();
    return parseFloat(data.data[0]?.values[0]);
  }

  async function loadStats() {
    try {
      const v2024 = await fetchStat('vaesto', '2024');
      const v2023 = await fetchStat('vaesto', '2023');
      document.getElementById('stat-vaesto').textContent = Math.round(v2024).toLocaleString('fi-FI');
      const diff = v2024 - v2023;
      document.getElementById('stat-vaesto-change').textContent = (diff > 0 ? '+' : '') + Math.round(diff) + ' hlö (vs 2023)';
      document.getElementById('stat-vaesto-change').className = 'stat-change ' + (diff >= 0 ? 'up' : 'down');

      const n2024 = await fetchStat('vaesto_alle15_p', '2024');
      document.getElementById('stat-nuoret').textContent = n2024.toFixed(1) + '%';
      document.getElementById('stat-nuoret-change').textContent = 'Väestörakenteen osuus';
    } catch (e) { console.error("Tilastovirhe", e); }
  }

  async function loadDecisions() {
    const list = document.getElementById('decisions-list');
    try {
      const res = await fetch(PROXY_URL);
      const buffer = await res.arrayBuffer();
      const text = new TextDecoder("windows-1252").decode(buffer);
      const parser = new DOMParser();
      const xml = parser.parseFromString(text, "application/xml");
      const items = xml.querySelectorAll("item");

      list.innerHTML = '';
      items.forEach((item, index) => {
        if(index > 10) return;
        const title = item.querySelector('title')?.textContent || 'Päätös';
        const pubDate = item.querySelector('pubDate')?.textContent || '';
        const dateStr = pubDate ? new Date(pubDate).toLocaleDateString('fi-FI') : '';

        const el = document.createElement('div');
        el.className = 'decision-item';
        el.innerHTML = `
          <div style="width: 8px; height: 8px; border-radius: 50%; background: var(--accent)"></div>
          <div>
            <div class="decision-title">${title}</div>
            <div class="decision-meta">Kokkola • ${dateStr}</div>
          </div>
          <div class="status-passed">Päätös</div>
        `;
        list.appendChild(el);
      });
    } catch (e) { list.innerHTML = '<div style="padding: 20px;">Virhe ladattaessa päätöksiä.</div>'; }
  }
</script>

</body>
</html>
